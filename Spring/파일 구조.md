# global, domain
프로젝트를 생성하고 파일 구조를 잡을 때 어떨 때 global과 domain을 쓰는지 조사해보았다.
<br>
global과 domain은 실제 프레임워크가 아니라, 개발자들이 기능을 구분하기 위해 쓰는 개념적 디렉토리 이름이다.

## global
프로젝트 전체에 공통적으로 영향을 주는 요소이다. 특정 도메인에서만 사용하는 것이 아닌 전 도메인이 공통으로 쓰는 것이다.

- SpringSecurity
- WedConfig
- JWT 필터, JWT provider
- 글로벌 인증/인가 핸들러
- 인증/인가 처리 로직
- 공통 Exception 코드
- Date 변환 유틸리티

등이 있다.

### 대표적인 global내 파일들을 알아보자!
- global/config
    - SecurityConfig.java
    <br>
    Spring security 설정 파일이다.
    - WebConfing.java
    <br>
    CORS 설정 시 필요하다.
- global/jwt
    - JwtTokenProvider.java
    <br>
    JWT 생성/검증, 토큰에서 사용자 정도 등을 추출한다.
    - JwtFilter.java
    <br>
    HTTP 요청이 들어올 때 Authorization 헤더를 확인한다.
    - JwtAuthenticationEntryPoint.java
    <br>
    인증 실패 시 JSON 형태로 오류 응답을 반환한다.
    - JwtAccessDeniedHandler.java
    <br>
    인가 실패 시 '권한 없음' 처리
- global/exceptin
    <br>
    공통 예외 처리 관련 패키지
    - GlobalExceptionHandler.java
    <br>
    ``@RestControllerAdvice``
    <br>
    프로젝트 전역에서 발생하는 예외를 모아서 한 곳에서 JSON 형태의 응답으로 반환

    - CustomException.java
    서비스 단에서 공통된 예외 구조 사용 가능하다.
- global/util
    - TokenUtils.java, DateUtils.java
    모든 도메인에서 사용할 수 있는 공통 유틸리티이다.

### 특징
특정 도메인에 속하는 기능이 아닌 모든 API 또는 대부분의 도메인이 함께 사용한다. 프로젝트의 인프라 역할을 한다.
> **인프라란?**
> <br>
>사회적 생산기반이나 경제활동의 기반이 되는 기초적인 시설 및 시스템

### global 기본 구조
```
global
 ├─ config
 ├─ jwt
 ├─ exception
 ├─ util
```

## domain
서비스가 제공하는 실제 기능을 기준으로 나누는 영역이다.
- User
- post
- follow

등이 있다.

### 특징
하나의 도메인에 해당 기능을 만드는 모든 요소가 모인다.
```
- controller
- service
- repository
- entity
- dto
```
이렇게 구성된다.

### 각각의 요소를 알아보자!
- controller
HTTP 요청을 받고 Service에 작업을 시킨다. -> Service의 결과를 HTTP 응답으로 변환하여 반환한다.

- Service
실제 작업을 한다.
<br>
예) 로그인 검증, 비밀번호 암호화, 주문 계산, 토큰 생성 요청 등이 있다.

- Repository
DB에 저장하고 조회한다.
>DB 작업 종류
>
>- ``save()`` : 저장
>- ``findById()`` : 조회
>- ``findAll()`` : 전체 조회
>- ``delete()`` : 삭제

- DTO
Controller와 Service 사이에서 전달하는 데이터 구조이다.

- Entity
DB 테이블과 1:1 대응되는 객체이다.

## JWT 기반 로그인 구현 시 파일 구조
```
src
 └── main
     └── java
         └── com.example.project
             ├── global
             │    ├── config
             │    │     └── SecurityConfig.java
             │    ├── jwt
             │    │     ├── JwtTokenProvider.java
             │    │     ├── JwtFilter.java
             │    │     ├── JwtAuthenticationEntryPoint.java
             │    │     └── JwtAccessDeniedHandler.java
             │    └── exception
             │          └── GlobalExceptionHandler.java
             │
             ├── domain
             │    └── user
             │        ├── controller
             │        │     └── UserController.java
             │        ├── service
             │        │     └── UserService.java
             │        ├── repository
             │        │     └── UserRepository.java
             │        ├── dto
             │        │     ├── LoginRequest.java
             │        │     ├── SignupRequest.java
             │        │     └── TokenResponse.java
             │        └── entity
             │              └── User.java
             │
             └── AppApplication.java
```
이렇게 구성이 된다.